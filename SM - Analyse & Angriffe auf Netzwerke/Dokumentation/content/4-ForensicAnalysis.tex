\chapter{Forensische Analyse} \label{chap:ForensischeAnalyse}
In diesem Kapitel wird der Ablauf der Computer forensischen Analyse im Detail aufgezeigt und erklärt. Die Techniken und Tools zur Unterstützung dieses Prozesses wird im Kapitel \ref{chap:ToolsTechniques} \nameref{chap:ToolsTechniques} erläutert.


\section{Einführung}
Der Prozess der forensischen Analyse lässt sich grundsätzlich in die nachfolgenden Phasen unterteilen werden. Die Erläuterung der einzelnen Phasen erfolgt in den nachfolgenden Kapiteln.

\begin{enumerate}
\item Readiness (Vorbereitung)
\item Secure (Sicherstellung)
\item Analysis (Analyse)
\item Documentation (Dokumentation)
\item Present (Präsentation)
\item Review (Rückblick)
\end{enumerate}

Ziel ist es es aus den vorhandenen Median die Daten zu extrahieren. Aus den extrahierten Daten werden Informationen gewonnen, welche anschliessend im Zuammenhang mit anderen Informationen als Beweis dienen können

\todo{Evtl. Bild Media -> Data --> Information --> Evidence}

\subsection{Ein guter Prozess}
Ein guter Prozess für eine forensische Analyse zeichnet sich durch folgende Punkte aus:

\begin{itemize}
\item Kreuzvalidierung von essentiellen Ergebnissen mit anderen Tools
\item Sauberer und Korrekter Umgang mit Beweismaterial
\item Vollständigkeit der Untersuchung
\item Management des Falles: Case-Management, Dokumentation, Archivierung
\item Dokumentierte und geprüfte Arbeitsprozesse
\item Konformität zu gesetzlichen Vorgaben und Restriktionen
\item Flexibilität
\end{itemize}

\section{Phasen}
\subsection{Readiness (Vorbereitung)}
Um während der Untersuchung Fehler zu verhindern und wertvolle Zeit einzusparen, ist es sinnvoll gewisse Vorbereitunsarbeiten vor einem Einsatz, beziehungsweise vor einer Untersuchung, durchzuführen. Die gleichen Arbeiten sollten auch nach Abschluss einer Untersuchung durchgeführt werden, da jederzeit der nächste Fall eintreten kann.

\textbf{Vorbereitungsarbeiten}
\begin{itemize}
\item Sterilisieren / Formatieren von Datenträgern für die Speicherung des Beweismaterials
\item Formulare und Protokolle vorbereiten und ausdrucken
\item Vorbereitung und Verpackung der notwendigen technischen Ausrüstung \\
\begin{itemize}
\item Kleines Werkzeugset
\item Digitalkamera
\item Notizblock und Stifte
\item Wasserfeste Filzstifte und Etiketten
\item Antistatische Beutel
\item Dokumente (Manuals, Anleitungen, Abläufe, etc. )
\item Writeblocker
\item Datenträger
\item (Mobiles) Analysesystem + Zubehör (Adapter, USB-Hubs, Card-Reader, Multi-Card-Reader, CD/DVD/Blue-Ray Leser / Brenner, Drucker)
\item ...
\end{itemize}
\item Vorbereitung und Verpackung der notwendigen Tools und Programme \\
\begin{itemize}
\item Datensicherung \todo{Übersetzen}
\item Data discovery
\item internet history
\item image viewers
\item E-mail viewers
\item Password-cracking tools
\item Mobile device tools
\item large storage analysis tools
\item ...
\end{itemize}
\end{itemize}

\subsection{Secure (Sicherstellen)}
Die Phase "`Secure"' lässt sich weiter in die Phasen "`Environment (Umgebung)"', "`Identify (Identifizieren)"', "`Collect (Sammeln)"' und "`Preserve (Aufbewahren)"' unterteilen.


\subsubsection{Environment (Umgebung)}
Diese Phase muss grundsätzlich nur berücksichtigt werden, wenn es sich bei der Untersuchung um eine Ermittlung im Rahmen einer Incident Response oder einer Tatortssicherung handelt.

Bei Ankunft des Ermittlers am "`Tatort"' sollte er sogleich sicherstellen, dass nur noch berechtigte Personen Zugang zum Tatort und der näheren Umgebung haben. Bevor die Personen den Tatort verlassen, sind zum einen die Kontaktdaten für spätere Rückfragen und zum anderen weitere Informationen (zum Beispiel: Passwörter, Besonderheiten des Systems) zu protokollieren. Sofern noch nicht erfolgt, sollte der Tatort isoliert und dokumentiert werden. Für die Tatortdokumentation sind Fotos und Skizzen sehr gut geeignet.

\subsubsection{Identify (Identifizieren)}
Bevor die ersten Daten gesichert werden können, müssen alle möglichen Datenquellen identifiziert werden. Dazu zählt zum Beispiel das zu untersuchende System, externe Festplatten, USB-Sticks, Wechseldatenträger, etc. Falls gestattet, sollte in der näheren Umgebung, zum Beispiel im Aktenschrank oder im Korpus, nach weiteren Datenträgern gesucht werden. Je nach Situation sind an weiteren Stellen (zum Beispiel beim Internet-Provider, Firewall, Roter, etc.) zusätzliche Informationen gespeichert. Gegebenenfalls sollte auch nach relevanten physischen Dokumenten, welche Hinweise oder wichtige Informationen beinhalten, gesucht werden. Zum Beispiel könnte eine mehr oder weniger gut versteckte Passwortliste die Arbeit erheblich erleichtern. Wurden nicht an ein System angeschlossene Datenträger, Medien  und Dokumente gefunden ist dies sofort zu dokumentieren und der Beweisgegenstand fachgerecht zu sichern (Siehe Abschnitt \nameref{subsubsec:FA:Secure:CollectPreserve}). 

\subsubsection{Collect (Sammeln) and Preserve (Aufbewahren)} \label{subsubsec:FA:Secure:CollectPreserve}
Bei der Sammlung von Daten gilt der Grundsatz, dass so wenig eigene Spuren hinterlassen werden sollten, als irgendwie möglich ist. Die Sicherung der Daten erfolgt grundsätzlich anhand Ihrer Halbwertszeit. Zuerst werden flüchtige Daten gesichert, anschliessend nicht flüchtige Daten. Innerhalb der flüchtigen Daten erfolgt die Reihenfolge der Sicherung auch anhand der Halbwertszeit. Es werden zuerst Caches, dann Hauptspeicherinhalte und anschliessend Informationen über Netzwerkverbindungen und Laufende Prozesse gesichert. Flüchtige Daten, sind Daten, welche nach einem Shutdown oder einem harten Shutdown des Systems nicht mehr verfügbar sind und unwiderruflich verloren sind.

Bevor mit der Sammlung und Aufbewahrung begonnen wird, sollte der Ermittler einen Plan aufstellen, welche Daten er in welcher Reihenfolge wie und mit welchen Tools und Techniken sichern sollte. Bei der Planung ist die Priorität der einzelnen Datenquellen zu berücksichtigen. Die Priorität setzt sich dabei aus folgenden Faktoren zusammen: Geschätzter Wert der Daten (basierend auf den Erfahrungen und der Einschätzung der Situation) und Aufwand (Zeit / Kosten / Ausrüstung) um die Daten zu sichern. Häufig ist es nicht möglich, alle Datenquellen einzusammeln, daher müssen diese priorisiert werden.

\paragraph{Harter vs. Normaler Shutdown}
Bei einem normalen Shutdown wird das System durch den Benutzer regulär heruntergefahren, sämtliche Daten werden gespeichert und das System befindet sich im Anschluss in einem sauberen / lauffähigen Zustand. Während dem Shutdown werden jedoch die Zeitstempel von sehr vielen Dateien verändert und temporäre Dateien und Arbeitsdateien des Betriebssystems gelöscht. Dies kann unter Umständen die Analysearbeiten erschweren oder sogar Beweise vernichten. 

Bei einem harten Shutdown wird das System von der Stromversorgung getrennt, ohne dieses vorher herunterzufahren. Mit diesem Vorgehen wird sichergestellt, dass keine Zeitstempel von Dateien verändert werden. Auch ist die Wahrscheinlichkeit da, dass auf der Festplatte eine Auslagerungsdatei vorhanden ist, welche anschliessend analysiert werden kann. Die Extraktion und anschliessende Analyse dieser Daten ist jedoch sehr aufwändig. Diese Methode des Shutdowns kann bei gewissen Dateisystemen zu irreparablen Schäden führen. Daher ist vorgängig abzuwägen, ob ein harter Shutdown sinnvoll und verkraftbar ist.

Bei einem Shutdown gehen in der Regel immer viele Daten verloren. Es wäre zum Beispiel möglich, dass der Angreifer ein Schadprogramm installiert hat, welches nur noch im RAM verfügbar ist. Nach einem weichen Shutdown ist das Programm auf dem System nicht mehr auffindbar. 

Bei beiden Varianten ist die Zeit der Durchführung und die Art des Shutdowns zu protokollieren.

\paragraph{Sicherung des RAM-Inhaltes}
Nachdem herunterfahren des Systems sind die Daten im RAM noch einige Sekunden verfügbar. Dies reicht in der Regel jedoch nicht um eine Datensicherung durchzuführen. Einige neuere Studien und Experimente haben gezeigt, dass es durchaus Mittel und Wege gibt, um den Inhalt des RAMS zu sichern. Eine Möglichkeit besteht darin, die Raumbausteine mit einem Stickstoffspray auf -50 Grad Celsius herunter gekühlt. Anschliessend wird der Rechner ausgeschaltet, der RAM ausgebaut und in ein anderes System eingebaut. Das System wird mit einer Spezialsoftware gestartet, welches einen Memory-Dump erstellt.

\paragraph{Writeblocker}
\todo{Writeblocker}
HW und SW

\paragraph{System ist eingeschaltet}
\begin{enumerate}
\item Nähere Umgebung und Zustand des Systems dokumentieren
\item Befindet sich das System im Standby? \\
Befindet sich das System im Standby ist abzuwägen, ob das System aufgeweckt oder ein harter Shutdown gemacht werden soll. In dieser Situation ist in der Regel ein harter Shutdown  zu empfehlen.
\item Ist der Screensaver aktiv? \\
Ist auf dem System ein Screensaver ist abzuwägen, ob dieser "`deaktiviert"' werden soll oder ein harter Shutdown gemacht werden soll. Dies ist stark situationsabhängig und sollte von Fall zu Fall entschieden werden. Ist anzunehmen, dass die Freischaltung des Screens mit einem Passwort erfolgt, welches nicht bekannt ist, ist auch hier der harte Shutdown zu empfehlen. Wird der Screensaver "`deaktiviert"' muss dies entsprechend mit der exakten Uhrzeit dokumentiert werden.
\item Ist das System durch ein Passwort geschützt? \\
Ist das System durch ein unbekanntes Passwort geschützt, ist in der Regel ein harter Shutdown zu empfehlen. In Ausnahmefällen kann durchaus auch ein Versuch unternommen werden, dass Passwort mit Hilfe von entsprechenden Werkzeugen zu knacken.
\end{enumerate}

Ist der Zugang zum System hergestellt, kann mit der Sicherung der flüchtigen Daten begonnen werden. 

\begin{enumerate}
\item Festhalten des Bildschirminhalts und der geöffneten Anwendungen
\item Festhalten der aktuellen Systemzeit und einer Referenzzeit, sowie deren Abweichung
\item Informationen über das verwendete Betriebssystem
\item Liste der aktiven Prozesse
\item Liste der geöffneten Sockets
\item Liste der Anwendungen, die auf geöffnete Sockets hören
\item Liste der angemeldeten User
\item Erstellen eines Memory Dumps
\item Sicherung des Hauptspeichers pro Prozess-ID
\item Sicherung der Cache- und Auslagerungsdateien
\item Liste der geöffneten Ports
\item Status und Statistik der Netzwerkverbindungen
\item Pro Prozess: Umgebungsvariablen, Übergabeparameter, geladene Bibliotheken, Offene Dateideskriptoren, etc.
\item ....Memory Dump?
\end{enumerate}


Ist die Sicherung der volatilen Daten abgeschlossen sollte das System mit einem harten Shutdown heruntergefahren werden.

\paragraph{System ist nicht eingeschaltet}
Ist das System ausgeschaltet oder wurde es heruntergefahren wird als erstes das System von der Stromversorgung getrennt, geöffnet, der Zustand dokumentiert und die verbauten Datenträger ausgebaut, beziehungsweise im Falle von USB-Sticks oder anderen Wechseldatenträgern, entfernt und beschriftet. 

Anschliessend wird von sämtlichen Datenträgern ein forensisches Duplikat erzeugt. Ein forensisches Duplikat ist eine Bitweise 1:1 Kopie des Quelldatenträgers.

Die Erstellung eines Duplikates ist grundsätzlich immer sinnvoll, da dies bessere Analysemöglichkeiten bietet. Ist die Untersuchung ein Teil einer Strafuntersuchung ist in jedem Fall die Anfertigung eines Duplikates zu empfehlen.

Sind sämtliche Datenträger entfernt, sollte das System gestartet und direkt das BIOS aufgerufen werden. Der entsprechende Key um ins BIOS zu wechseln sollte vorab ermittelt / recherchiert werden. Anschliessend sind sämtliche BIOS-Informationen zu dokumentieren. Besonders wichtig ist auch hier die im BIOS eingestellte Systemzeit und das Datum. Besteht eine Diskrepanz zur aktuellen Zeit oder zur notierten Zeit des Betriebssystemes ist dies entsprechend zu notieren und später zu berücksichtigen.

\paragraph{Beweiskette und Beweissicherung}
-Pro Beweis: Beweiszettel, kein Zweifel an Herkunft, Besitztum, Sicherstellung Unversertheit
-Pro Objekt: Zettel
-Antistatischer Sack
-original: mitnehmen oder wieder in Betrieb (je nach Situation)

\paragraph{Sicherung}
Haupteinheit (evtl. nur Datenträger), evtl. Spezialgeräte, Stromkabel, Sämtliche externen Datenträger, Wechselmedien wie DVD, CD, Disketten, USB-Sticks, WORM, Speicherkarten 
-Externe Kommunikationssysteme; WLAN-Router, Modem, spezial-HW / Peripherie, Digitalkameras, MP3-Player, PDAs, Mobiltelefone)

Zum Teil schaden grösser Bei Mitnahme / Ausbau, Abwägung
http://forensic.belkasoft.com/en/live-ram-forensics

Auf sterilisierten Datenträgern


%--------------------------------------------------
\subsection{Analysis (Analyse)}
Die Analyse Phase unterteilt sich zum einen in die Phase "`Examination (Untersuchung)"' und zum anderen in die eigentliche Analyse-Phase. Der Übergang zwischen diesen beiden Phasen ist fliessend und lässt sich nicht immer klar trennen. Mit Abschluss der Secure-Phase kann der Ermittler sämtliche weiteren Arbeiten im Labor durchführen. Die Anwesenheit am Tatort ist nicht mehr zwingend, da sämtliches Material eingesammelt und gesichert wurde.

Die anzuwendenden Techniken und durchzuführenden Schritte bei der Analyse sind stark von der Situation abhängig. Bei der Untersuchung einer Cyber-Attacke sind oft andere Aspekte relevant, als bei der Untersuchung einer Entführung oder eines Mordfalles. Im nachfolgenden Abschnitt werden einige Ansatzpunkte für eine Untersuchung aufgezeigt.

\subsubsection{Examination (Untersuchung)}
Bevor die Untersuchung und die Analyse durchgeführt werden kann, muss das forensische Image gemountet werden. Dafür gibt es verschiedene Vorgehensweisen. In jedem Fall ist jedoch sicherzustellen, dass das Image ReadOnly gemountet wird. Im Idealfall wird vor und nach der Analyse jeweils ein Hash des Images erstellt, um zu verifizieren, dass das Image nicht manipuliert / verändert wurde.

Kontext Abhängig
Trojanisierte Systemprogramme
-Versteckte Dateien / Verzeichnisse

\begin{enumerate}
\item Wiederherstellung des File-Systems / der Beweisspuren (gelöschte, umbenannte, versteckte, verschlüsselte Dateien)
\item Generierung von Hashes für alle Dateien.
\item Abgleich der generierten Hashes. \\
Die generierten Hashes können mit Datenbanken abgeglichen werden, welche Hashes von zahlreichen System- / Programmdateien von verschiedenen Betriebssystemen und Programmen enthalten. Die so als irrelevant identifizierten Dateien können für die weitere Analyse ausgeblendet werden.
\item Suchindex über sämtliches Material erstellen \\
Es wird empfohlen ein Suchindex aus lesbaren Zeichen zu bilden. Bei der Index-Erstellung ist darauf zu achten, dass auch der File-Slack, alle belegten und unbelegten Bereiche auf dem Datenträger und die Metadaten des Dateisystems indexiert werden.
\item Kategorisierung der Dateien (zum Beispiel nach Typ)

\end{enumerate}

\begin{itemize}
\item Analyse des File Slacks
\item Timeline-Analyse
\item Analyse der Auslagerungsdateien
\item Analyse der versteckten Dateien
\item Analyse unbekannter Binärdateien
\item Analyse der Systemprotokolle
\item Analyse der Netzwerkschnittstellen
\item Untersuchung der Shell
\item Untersuchung der Druckerjobs und der Druckerqueue
\item Untersuchung der Dateien / Dateiendungen
\item Bei Verdacht auf Einsatz von Anti-Forensik-Techniken: Vertiefte Analyse
\item Untersuchung von User Aktivitäten
\item Weitere Untersuchungen auf Anwendungsebene (zum Beispiel: E-Mail, Browser)
\end{itemize}

\subsubsection{Analysis (Analyse)}
Analyse mit juristisch verwertbaren Methoden und Techniken und Informationen zur Unterstützung des Falles zu erhalten

Die gefundenen Beweisspuren werden analysiert und in ein der folgenden drei Gruppen eingeteilt.

-Scheduler / Cronjobs
-OS-Logs
-
\begin{itemize}
\item Beweise untermauern eine bestimmte Theorie.
\item Beweise widerlegen eine bestimmte Theorie.
\item Beweise unterstützen keine bestimmte Theorie.
\end{itemize}

Die Schwierigkeit bei der Analyse der Informationen besteht darin, diese in einen kausalen und zeitlichen Zusammenhang zu setzen. Diese Zusammenhänge müssen zum einen plausibel und nachvollziehbar sein und zum anderen mit anderen Ereignissen korrelieren. 


-Verbindung herstellen: besuchte Webseiten, Hinweise E-Mails, Chats, Via Grammatik Stiel?

\paragraph{Unterstützende Fragestellungen}
\begin{itemize}
\item War ein physischer Zugang zum System notwendig?\\
Ja: Kontrolle der physischen Überwachung und Zutrittskontrolle.
\item Hatten andere Personen Zugang zum System?\\
Ja: Kontrolle der physischen Überwachung und Zutrittskontrolle.
\item Was für Computerkenntnisse hat der Verdächtige? Was für Computerkenntnisse waren notwendig?
\end{itemize}

%--------------------------------------------------
\subsection{Reporting (Dokumentation)}
Die gesamte forensische Untersuchung muss im Detail protokolliert und dokumentiert werden. Es müssen sämtliche Arbeitsschritte nachvollzogen und gegebenenfalls durch einen anderen Experten reproduziert werden können. Die eingesetzten Tools (inkl. Version) und Techniken sollten kurz beschrieben werden Im Rahmen einer Strafuntersuchung müssen die durchgeführten Schritte und angewandten Techniken so erläutert werden, dass diese von Laien verstanden und nachvollzogen werden können.

Die Dokumentation der Untersuchung sollte soweit als möglich und praktikabel sofort bei der Durchführung erstellt werden, da ansonsten wichtige Informationen, Gedanken und Arbeitsschritte verloren gehen. Die Dokumentation ist mit Screenshots oder gegebenenfalls Fotos, welche mit der Digitalkamera aufgenommen wurden, zu unterlegen.

Evtl. auflistung besser?
\begin{itemize}
\item Verwendete Tools (inkl. Versionsnummer)
\item Verwendete Hardware (zum Beispiel FastBloc Write Blocker)
\item Angewendete Techniken
\item Prüfsummen von Dokumenten, Protokollen und Beweisen
\item Erläuterung der Evaluation der Tools und Techniken
\end{itemize}

\todo{HE CF: S. 341}

\subsection{Present (Präsentation)}


\subsection{Review (Rückblick)}

\section{Hinweise zur forensischen Analyse}
Bei einer forensischen Analyse sind folgende wichtige Aspekte zu berücksichtigen.

\begin{itemize}
\item \textbf{Zeuge / Zweitperson} \\
Während der Untersuchung sollte eine Zweitperson, bzw. ein Zeuge anwesend sein.
\item \textbf{Protokollierung} \\
Sämtliche durchgeführten Arbeitsschritte müssen protokolliert werden. Am Ende der Untersuchung sollte das Protokoll durch den Zeugen, die Zweitperson abgenommen und von beiden unterschrieben werden.
\item \textbf{Schutz der eigenen Umgebung} \\
Die eigene Analyseumgebung sollte gut gegen Angriffe geschützt sein und nicht direkt mit dem angegriffenen System oder Netzwerk verbunden werden. Sollte sich der Angreifer noch im Netzwerk oder auf dem System befinden, könnte er das Analysesystem angreifen und weiteren Schaden anrichten.
\item \textbf{Schutz der Beweismittel} \\
Sämtliche Beweismittel müssen sichergestellt und anschliessend geschützt werden. Eine Veränderung der Daten nach der Sicherung darf nicht mehr möglich sein beziehungsweise muss zweifelsfrei festgestellt werden können.
\item \textbf{Verwendung von Systembefehlen} \\
Zur Sammlung und Sicherung von Daten sollten niemals Systembefehle verwendet werden. Die Systemprogramme könnten vom Angreifer durch modifizierte Programme ausgetauscht werden sein. Der Ermittler sollte immer statisch vorkompilierte Programme verwenden.
\item \textbf{Einsatz Grafischer Programme} \\
Bei der Untersuchung eines Live-Systems sollte soweit als möglich auf den EInsatz von Programmen mit einer grafischen Oberfläche verzichtet werden. Grund dafür ist, dass diese eine Vielzahl an Binärdateien und Konfigurationen benötigen. Zum einen werden dadurch viele Zeitstempel geändert und zum anderen benötigen diese mehr RAM als Konsolenanwendungen.
\item \textbf{Patches und Updates} \\
Eher nicht, wenn kritisch, nach Rücksprache, Vernichtung Beweise
\item \textbf{Remote Untersuchung} \\
Bei einer forensischen Analyse ist nicht immer ein direkter Zugriff auf das System vorhanden. Gewisse Forensik-Tools erlauben den Einsatz via Netzwerk. Diese benötigt jedoch auf dem zu untersuchenden System einen entsprechenden Forensik-Client, mit welchem sich der Server anschliessend verbinden kann. Dieser sollte bereits vorgängig (vor dem Sicherheitsvorfall) auf dem System installiert worden sein.
\end{itemize}
